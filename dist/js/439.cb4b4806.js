"use strict";(self["webpackChunklike"]=self["webpackChunklike"]||[]).push([[439],{9355:function(e,t,r){r.r(t),r.d(t,{default:function(){return h}});var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"users"},[r("MBX",{attrs:{label1:"用户管理",label2:"用户列表"}}),r("el-card",[r("el-input",{staticClass:"input-with-select",staticStyle:{width:"400px"},attrs:{placeholder:"请输入内容",clearable:""},on:{clear:e.clear,input:e.input},model:{value:e.current.query,callback:function(t){e.$set(e.current,"query",t)},expression:"current.query"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1),r("el-button",{staticClass:"ml",attrs:{type:"primary"},on:{click:e.add}},[e._v("添加用户")]),[r("el-table",{staticClass:"mt",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",stripe:""}},[r("el-table-column",{attrs:{type:"index",label:"#",width:"50"}}),r("el-table-column",{attrs:{prop:"username",label:"姓名",width:"180"}}),r("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),r("el-table-column",{attrs:{prop:"mobile",label:"电话"}}),r("el-table-column",{attrs:{prop:"role_name",label:"角色"}}),r("el-table-column",{attrs:{prop:"mg_state",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-switch",{on:{change:function(r){return e.change(t.row)}},model:{value:t.row.mg_state,callback:function(r){e.$set(t.row,"mg_state",r)},expression:"scope.row.mg_state"}})]}}])}),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(r){return e.updates(t.row)}}}),r("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(r){return e.del(t.row)}}}),r("el-button",{attrs:{size:"mini",type:"warning",icon:"el-icon-s-tools"},on:{click:function(r){return e.set(t.row)}}})]}}])})],1)],r("div",{staticClass:"block mt"},[r("el-pagination",{attrs:{"current-page":e.current.pagenum,"page-sizes":[3,5,8,10],"page-size":e.current.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),r("el-dialog",{attrs:{title:0==e.title?"添加用户":1==e.title?"编辑用户":"分配角色",visible:e.dialogVisible,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{directives:[{name:"show",rawName:"v-show",value:2!=e.title,expression:"title != 2"}],ref:"form",staticClass:"demo-ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"用户名",prop:"username"}},[r("el-input",{attrs:{disabled:1==e.title},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),0==e.title?r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1):e._e(),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),r("el-form-item",{attrs:{label:"电话",prop:"mobile"}},[r("el-input",{model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:2==e.title,expression:"title == 2"}]},[r("li",[e._v("当前的用户 : "+e._s(e.userBox.username))]),r("li",{staticClass:"mt"},[e._v("当前的角色 : "+e._s(e.userBox.role_name))]),r("div",{staticClass:"mt"},[e._v(" 分配新角色 : "),r("el-cascader",{attrs:{options:e.options,props:e.defaultParams},on:{change:e.handleChange},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)]),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),r("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1)],2)],1)},s=[],n=r(6486),a=r.n(n),l=r(2552),o=r(2348),u={data(){return{title:0,_:a(),form:{username:"",password:"",email:"",mobile:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:15,message:"长度在6 到 15 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^(?![\d]+$)(?![a-zA-Z]+$)(?![^\da-zA-Z]+$)([^\u4e00-\u9fa5\s]){6,20}$/,message:"请输入6-20位英文字母、数字或者符号（除空格），且字母、数字和标点符号至少包含两种",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/^([a-zA-Z0-9]+[-_\.]?)+@[a-zA-Z0-9]+\.[a-z]+$/,message:"请输入正确的邮箱",trigger:"blur"}],mobile:[{required:!0,message:"请输入电话号码",trigger:"blur"},{pattern:/^[1][3-9][0-9]{9}$/,message:"请输入正确的电话号码",trigger:"blur"}]},tableData:[],tableDataS:[],current:{query:"",pagenum:1,pagesize:3},total:10,dialogVisible:!1,id:0,userBox:{},value:[],options:[{value:"zhinan",label:"指南"}],defaultParams:{label:"roleName",value:"id",children:""}}},methods:{input:a().debounce((function(){this.send()}),300),async send(){const e=await(0,l.GJ)(this.current);this.current.pagenum=e.pagenum,this.total=e.total,this.tableData=e.users,this.tableDataS=this.tableData},add(){this.form={},this.dialogVisible=!0,this.title=0,this.$refs.form&&this.$refs.form.resetFields()},async submitForm(){if(2==this.title){if(500==this.id)return this.$message({type:"info",message:"不允许修改admin"}),!1;await(0,l.uq)({id:this.id,rid:this.value[0]});return this.dialogVisible=!1,this.send(),!1}this.$refs.form.validate((async e=>{if(!e)return!1;if(0==this.title){await(0,l.FZ)(this.form);this.dialogVisible=!1,this.send()}else console.log(this.form),(0,l.o9)({id:this.id,email:this.form.email,mobile:this.form.mobile}).then((e=>{this.dialogVisible=!1,this.send()}))}))},handleSizeChange(e){this.current.pagesize=e,this.send()},handleCurrentChange(e){this.current.pagenum=e,this.send()},handleClose(e){this.$confirm("确认关闭？").then((t=>{e()})).catch((e=>{}))},updates(e){this.$refs.form&&this.$refs.form.resetFields(),this.id=e.id,this.dialogVisible=!0,this.title=1,this.form=JSON.parse(JSON.stringify(e)),console.log(this.form)},del(e){this.id=e.id,this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{await(0,l.v6)({id:this.id});this.send()})).catch((()=>{this.$message({type:"warning",message:"已取消删除"})}))},async set(e){this.id=e.id;const t=await(0,l.G7)();this.options=t,this.title=2,this.dialogVisible=!0,this.userBox=e},search(){},clear(){this.send()},async change(e){console.log(e);await(0,l.ZM)({id:e.id,type:e.mg_state});this.send()},handleChange(e){this.value=e}},components:{MBX:o.Z},computed:{},watch:{},created(){this.send()}},c=u,d=r(1001),m=(0,d.Z)(c,i,s,!1,null,"2b1a85eb",null),h=m.exports},2552:function(e,t,r){r.d(t,{Aq:function(){return w},BL:function(){return b},BM:function(){return p},FZ:function(){return l},G7:function(){return h},GJ:function(){return a},Ig:function(){return s},Mo:function(){return m},ZM:function(){return c},bJ:function(){return n},c4:function(){return v},lf:function(){return f},o9:function(){return o},rp:function(){return g},uq:function(){return d},v6:function(){return u}});var i=r(1899);function s(e){return(0,i.Z)({url:"login",method:"POST",data:e})}function n(){return(0,i.Z)({url:"menus",method:"GET"})}function a(e){return(0,i.Z)({url:"users",method:"GET",params:e})}function l(e){return(0,i.Z)({url:"users",method:"POST",data:e})}function o(e){return(0,i.Z)({url:"users/"+e.id,method:"PUT",data:e})}function u(e){return(0,i.Z)({url:"users/"+e.id,method:"DELETE"})}function c(e){return(0,i.Z)({url:"users/"+e.id+"/state/"+e.type,method:"PUT"})}function d(e){return(0,i.Z)({url:"users/"+e.id+"/role/",method:"PUT",data:e})}function m(e){return(0,i.Z)({url:"rights/"+e.type,method:"GET"})}function h(){return(0,i.Z)({url:"roles/",method:"GET"})}function f(e){return(0,i.Z)({url:"roles/",method:"POST",data:e})}function p(e){return(0,i.Z)({url:"roles/"+e.id,method:"PUT",data:e})}function b(e){return(0,i.Z)({url:"roles/"+e.id,method:"DELETE"})}function g(e){return(0,i.Z)({url:"roles/"+e.id+"/rights",method:"POST",data:e})}function v(e){return(0,i.Z)({url:"roles/"+e.roleId+"/rights/"+e.rightId,method:"DELETE"})}function w(e){return(0,i.Z)({url:"reports/type/1",method:"GET"})}}}]);
//# sourceMappingURL=439.cb4b4806.js.map